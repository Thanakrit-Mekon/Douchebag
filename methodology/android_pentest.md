# Android Peneteration

## Emulator setup

Get android-studio

```bash
brew install android-studio
```

Create Emulator

> android-studio => More actions => Virtual Device Manager => Create a device => Pixel4 =>API 30

## Root / Jailbreak

Get android-platform-tools

```bash
brew install android-platform-tools
```

Download Magisk app

> [https://github.com/topjohnwu/Magisk/releases](https://github.com/topjohnwu/Magisk/releases)

Install Magisk

> Either use Drag-Drop or adb install
>
```bash
adb install magisk.apk
```

Download RootAVD

> [https://github.com/newbit1/rootAVD/archive/refs/heads/master.zip](https://github.com/newbit1/rootAVD/archive/refs/heads/master.zip)

Run RootAVD to allowed root

```bash
./rootAVD.sh ~/Library/Android/sdk/system-images/android-30/google_apis_playstore/x86/ramdisk.img
```

> Then Cold reboot (Normal reboot take a while)

Try Sudo in android

```bash
adb shell su
```

> Grant Root in Emulator device if asked.

## Setup for BurpSuite

Reverse proxy settings

```bash
adb reverse tcp:8080 tcp:8080

adb shell settings put global http_proxy 127.0.0.1:8080
```

* **On PC**

  1. Open Burp on 8080

* **On Emu**

  1. Chrome:  [http://burp](http://burp)
  2. Download cert
  3. Rename from .der => .cer
  4. Setting => security => encryption & creds => install cert => CA cert => install

* **On PC**

  1. Download Always Trust Certs (Don't extract zip file)

      [https://github.com/NVISOsecurity/MagiskTrustUserCerts/releases/download/v0.4.1/AlwaysTrustUserCerts.zip](https://github.com/NVISOsecurity/MagiskTrustUserCerts/releases/download/v0.4.1/AlwaysTrustUserCerts.zip)
  1. Install Always Trust Certs

      ```bash
      adb push AlwaysTrustUserCerts.zip /sdcard/Download
      ```

* **On Emu**

   > Magisk app => Module (Bottom right) => install => select zip file => reboot

* **On PC**

   ```bash
   adb reverse tcp:8080 tcp:8080

   adb shell settings put global http_proxy 127.0.0.1:8080
   ```

## Use proxy setting every start Emu

```bash
adb reverse tcp:8080 tcp:8080

adb shell settings put global http_proxy 127.0.0.1:8080
```

Remove reverse port settings

```bash
adb reverse --remove-all
```
